<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Today's Delivered Parcels</title>
<style>
body { font-family: Arial; padding: 20px; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background: #f4f4f4; }
.count { font-size: 18px; font-weight: bold; margin-top: 15px; }
</style>
</head>
<body>

<h2>ðŸ“¦ Today's Delivered Parcels</h2>

<div class="count" id="count"></div>

<table>
<thead>
<tr>
  <th>Tracking No</th>
  <th>From City</th>
  <th>Delivery Date</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const webAppUrl = "https://script.google.com/macros/s/AKfycby9f86QjvNESTF8Rm0oYfaZEMOvpCjyQ_TZL1id8lkLZu0Ck1qYPIhrSwVbxYuxdSUe7g/exec";
let refreshInterval;

function loadData() {
  // Remove previous script tag if exists
  const oldScript = document.getElementById("jsonpScript");
  if (oldScript) oldScript.remove();

  // Create new JSONP script tag
  const script = document.createElement("script");
  script.src = webAppUrl + "?callback=handleData";
  script.id = "jsonpScript";
  document.body.appendChild(script);
}

// Callback function called by the JSONP Web App
function handleData(data) {
  const table = document.getElementById("tableBody");
  table.innerHTML = "";
  document.getElementById("count").innerText = "Total Delivered Today: " + data.length;

  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.trackingNumber}</td>
      <td>${row.fromAddress}</td>
      <td>${row.deliveryDate}</td>
      <td>${row.status}</td>
    `;
    table.appendChild(tr);
  });
}

// Auto-refresh every 60 seconds
function startAutoRefresh() {
  if (refreshInterval) clearInterval(refreshInterval);
  refreshInterval = setInterval(loadData, 60000); // 1 minute
}

// Load initially and start auto-refresh
window.onload = function() {
  loadData();
  startAutoRefresh();
};
</script>

</body>
</html>
