<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Upload Sample Images</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial; padding: 20px; margin: 0; background: #f7f7f7; }
  h2 { text-align: center; }
  select, input, button { margin: 10px 0; width: 100%; padding: 10px; box-sizing: border-box; }
  button { background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
  button:disabled { opacity: 0.7; cursor: not-allowed; }
  .preview-container { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
  .preview { width: 100px; height: 100px; border: 1px solid #ccc; border-radius: 5px; overflow: hidden; position: relative; background: white; }
  .preview img { width: 100%; height: 100%; object-fit: cover; }
  .remove-btn { position: absolute; top: 2px; right: 2px; background: red; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; }
  #addMoreBtn { width: 50px; height: 50px; font-size: 24px; display: flex; align-items: center; justify-content: center; }
</style>
</head>
<body>

<h2>Upload Sample Images</h2>

<label for="trackingSelect">Select Tracking Number:</label>
<select id="trackingSelect">
  <option value="">Select Tracking Number</option>
</select>

<div class="preview-container" id="previewContainer">
  <button type="button" id="addMoreBtn">+</button>
</div>

<button id="uploadBtn">Upload</button>

<script>
const WEB_APP_URL = "YOUR_GOOGLE_SCRIPT_URL";

const trackingSelect = document.getElementById("trackingSelect");
const previewContainer = document.getElementById("previewContainer");
const uploadBtn = document.getElementById("uploadBtn");
const addMoreBtn = document.getElementById("addMoreBtn");
let filesToUpload = [];

// Add more images
addMoreBtn.addEventListener("click", () => {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.capture = "environment";
  input.style.display = "none";
  input.addEventListener("change", e => {
    const fileList = e.target.files;
    if(fileList.length>0){
      for(const file of fileList){
        const wrapper = document.createElement("div");
        wrapper.className = "preview";
        const img = document.createElement("img");
        img.src = URL.createObjectURL(file);
        const removeBtn = document.createElement("button");
        removeBtn.className="remove-btn"; removeBtn.textContent="Ã—";
        removeBtn.onclick=()=>{ wrapper.remove(); filesToUpload.splice(filesToUpload.indexOf(file),1); };
        wrapper.appendChild(img); wrapper.appendChild(removeBtn);
        previewContainer.insertBefore(wrapper, addMoreBtn);
        filesToUpload.push(file);
      }
    }
  });
  document.body.appendChild(input); input.click(); document.body.removeChild(input);
});

// Upload Images
uploadBtn.addEventListener("click", async () => {
  const tracking = trackingSelect.value;
  if(!tracking) return alert("Select tracking number");
  if(filesToUpload.length==0) return alert("Select images");

  uploadBtn.disabled=true; uploadBtn.textContent="Uploading...";
  const imagesParam = filesToUpload.map(f=>URL.createObjectURL(f)).join("|");
  try {
    await fetch(WEB_APP_URL, { method:"POST", body:new URLSearchParams({tracking, image:imagesParam}) });
    alert("Uploaded successfully! Redirecting to Dashboard...");
    setTimeout(()=>{ window.location.href="./dashboard.html"; }, 1500);
  } catch(err){ alert("Upload failed"); }
  finally { uploadBtn.disabled=false; uploadBtn.textContent="Upload"; }
});
</script>

</body>
</html>
